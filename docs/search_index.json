[["data-preparation.html", "Chapter 1 Data Preparation", " Chapter 1 Data Preparation This section covers how to prepare a corpus for text analysis. I’ll work with the customer reviews of London-based hotels data set hosted on data.world. hotel_raw contains 27K reviews of the top 10 most- and least-expensive hotels in London. The csv file is located online here. I saved it to my \\inputs directory. library(tidyverse) library(tidytext) library(scales) library(glue) hotel_0 &lt;- read_csv(&quot;input/london_hotel_reviews.csv&quot;) %&gt;% mutate( `Date Of Review` = lubridate::mdy(`Date Of Review`), `Property Name` = str_trim(str_remove(`Property Name`, &quot;Hotel&quot;)), `Property Name` = str_trim(str_remove(`Property Name`, &quot;The&quot;)), `Property Name` = case_when( str_detect(`Property Name`, &quot;^45 Park Lane&quot;) ~ &quot;45 Park Lane&quot;, str_detect(`Property Name`, &quot;^Apex&quot;) ~ &quot;Apex&quot;, str_detect(`Property Name`, &quot;^Bulgari&quot;) ~ &quot;Bulgari&quot;, str_detect(`Property Name`, &quot;^Corinthia&quot;) ~ &quot;Corinthia&quot;, str_detect(`Property Name`, &quot;^London Guest House&quot;) ~ &quot;Guest House&quot;, str_detect(`Property Name`, &quot;^Xenia&quot;) ~ &quot;Xenia&quot;, str_detect(`Property Name`, &quot;^Mandarin&quot;) ~ &quot;Mandarin&quot;, str_detect(`Property Name`, &quot;^Mondrian&quot;) ~ &quot;Mondrian&quot;, str_detect(`Property Name`, &quot;^Wellesley&quot;) ~ &quot;Wellesley&quot;, TRUE ~ `Property Name` ), `Property Name` = factor(`Property Name`), review_id = row_number() ) %&gt;% janitor::clean_names(case = &quot;snake&quot;) %&gt;% rename(review_dt = date_of_review, reviewer_loc = location_of_the_reviewer) %&gt;% select(review_id, everything()) ## Rows: 27330 Columns: 6 ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: &quot;,&quot; ## chr (5): Property Name, Review Title, Review Text, Location Of The Reviewer,... ## dbl (1): Review Rating ## ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. hotel_0 contains 27,330 reviews of 20 hotels posted between 2002-04-01 and 2018-10-18. The raw data needs cleaned. One issue is tags like &lt;e9&gt; and unicode characters like &lt;U+0440&gt;. One way to get rid of unicode characters is to convert them to ASCII tags with iconv() and then remove the ASCII tags with str_remove(). E.g., iconv() converts &lt;U+0093&gt; to &lt;93&gt; which you can remove with regex \"\\\\&lt;[:alnum]+\\\\&gt;]\".1 hotel_1 &lt;- hotel_0 %&gt;% mutate( review_text = iconv(review_text, from = &quot;&quot;, to = &quot;ASCII&quot;, sub = &quot;byte&quot;), review_text = str_remove_all(review_text, &quot;\\\\&lt;[[:alnum:]]+\\\\&gt;&quot;) ) Exclude reviews written in a foreign language. One heuristic to handle this is to look for words common in other languages that do not also occur in English. hotel_2 &lt;- hotel_1 %&gt;% filter(!str_detect(review_text, &quot;( das )|( der )|( und )|( en )&quot;)) %&gt;% # German filter(!str_detect(review_text, &quot;( et )|( de )|( le )|( les )&quot;)) %&gt;% # French filter(!str_detect(review_text, &quot;( di )|( e )|( la )&quot;)) %&gt;% # Italian filter(!str_detect(review_text, &quot;( un )|( y )&quot;)) # Spanish hotel_2 %&gt;% count(property_name, review_rating) %&gt;% mutate(review_rating = factor(review_rating)) %&gt;% ggplot(aes(y = fct_rev(property_name), x = n, fill = fct_rev(review_rating))) + geom_col(color = &quot;gray80&quot;) + scale_fill_brewer(type = &quot;div&quot;, direction = -1) + labs( y = NULL, fill = NULL, title = glue(&quot;{comma(nrow(hotel_2),1)} Reviews of 20 Hotels&quot;) ) That removes 3,557 rows. Tokenize the reviews. tokens_0 &lt;- unnest_tokens(hotel_2, &quot;word&quot;, review_text) tokens_0 %&gt;% count(review_id) %&gt;% mutate(n_bin = cut(n, breaks = c(0, seq(50, 500, 50), Inf))) %&gt;% summarize(.by = n_bin, n = n()) %&gt;% ggplot(aes(x = n_bin, y = n)) + geom_col() At this point, you might decide to throw out smaller reviews. (Gils 2020) References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
